# CGMiner-RS 配置文件 - 软算法核心默认配置
# 详细配置说明请参考: docs/configuration.md
#
# 本配置文件默认使用软算法核心 (Software Core)
# 软算法核心特点:
# - 使用真实的SHA256算法进行CPU挖矿计算
# - 产生真实可用的挖矿数据和份额，可提交到真实矿池
# - 适合Mac环境、开发测试和低功耗挖矿场景
# - 支持多设备并行挖矿，提高CPU利用率
# - 与F2Pool等主流矿池完全兼容
#
# 如需使用ASIC硬件，请:
# 1. 将 cores.enabled_cores 改为 ["asic"]
# 2. 将 cores.default_core 改为 "asic"
# 3. 启用 cores.asic_core.enabled = true
# 4. 配置相应的ASIC硬件参数

[general]
# 日志级别: trace, debug, info, warn, error
log_level = "info"

# 日志文件路径 (可选)
log_file = "/var/log/cgminer-rs/cgminer.log"

# PID 文件路径 (可选)
pid_file = "/var/run/cgminer-rs.pid"

# 工作重启超时时间 (秒)
work_restart_timeout = 60

# 扫描时间间隔 (秒)
scan_time = 30

# =============================================================================
# 核心配置 (重命名后的核心库)
# =============================================================================
[cores]
# 启用的核心列表 - 使用重命名后的核心名称
# 可选值: ["btc-software", "maijie-l7"] 或 ["btc-software"] 或 ["maijie-l7"]
enabled_cores = ["btc-software"]

# 默认核心 - Bitcoin软算法核心 (cgminer-s-btc-core)
# 软算法核心使用CPU进行真实的比特币挖矿计算，产生可用的挖矿数据
default_core = "btc-software"

# Bitcoin软算法核心配置 (cgminer-s-btc-core)
# Bitcoin软算法核心特点:
# - 使用真实的SHA256算法进行CPU挖矿
# - 产生真实可用的挖矿数据和份额
# - 适合Mac环境和开发测试
# - 支持多设备并行挖矿
# - 支持CPU绑定，避免线程切换提升性能
[cores.btc_software]
enabled = true
# 🎯 CPU使用率优化配置 - 目标80%CPU使用率
# 设备数量 = CPU逻辑核心数 * 0.8 (80%使用率)
# 对于8核16线程系统: 16 * 0.8 = 12-13个设备
# 对于4核8线程系统: 8 * 0.8 = 6-7个设备
# 建议根据实际CPU核心数调整，公式: CPU逻辑核心数 * 0.8
device_count = 64            # 优化设备数量以达到80%CPU使用率
min_hashrate = 3000000000.0  # 最小算力: 1.5 GH/s (适中配置)
max_hashrate = 12000000000.0  # 最大算力: 4 GH/s (平衡性能与稳定性)
error_rate = 0.001           # 错误率: 0.1% (更低错误率提升效率)
batch_size = 15000            # 增大批处理大小提高CPU利用率
work_timeout_ms = 1500       # 减少工作超时提高响应速度
# 性能优化参数
thread_priority = "high"     # 线程优先级: "normal", "high", "realtime"
cpu_intensive_mode = true    # 启用CPU密集模式，最大化CPU使用
# Mac M4 优化配置
enable_cpu_affinity = false  # macOS限制CPU绑定

# CPU绑定配置 - 智能CPU分配策略
[cores.btc_software.cpu_affinity]
enabled = true               # 启用CPU绑定
strategy = "intelligent"     # 智能CPU绑定策略，自动优化分配
avoid_hyperthreading = false # 使用超线程提高并发性能
prefer_performance_cores = true # 优先使用性能核心(适用于大小核架构)
# 高级CPU优化选项
load_balancing = true        # 启用负载均衡
cpu_usage_target = 0.8       # 目标CPU使用率 80%
# manual_mapping = { 0 = 0, 1 = 1, 2 = 2, 3 = 3 }  # 手动映射 (仅在strategy="manual"时使用)

# Maijie L7 ASIC核心配置 (cgminer-a-maijie-l7-core)
# 注意: 在Mac环境下通常不可用，主要用于Linux环境的Maijie L7设备
[cores.maijie_l7]
enabled = false              # 默认禁用ASIC核心
chain_count = 3
spi_speed = 6000000          # 6MHz
uart_baud = 115200
auto_detect = true
power_limit = 3000.0         # 3kW
cooling_mode = "auto"

# =============================================================================
# 设备配置 (软算法核心设备配置)
# =============================================================================
[devices]
# 自动检测设备 - 软算法核心会自动创建虚拟设备
auto_detect = true
# 设备扫描间隔 (秒) - 软算法设备扫描频率
scan_interval = 10

# 软算法设备链配置 (虚拟链，用于模拟ASIC链结构)
# 注意: 软算法核心会根据device_count自动创建设备
# 以下配置主要用于兼容性，实际参数由软算法核心管理
[[devices.chains]]
id = 0
enabled = true
frequency = 1000             # 虚拟频率 (MHz) - 影响算力计算
voltage = 900                # 虚拟电压 (mV) - 用于功耗估算
auto_tune = false            # 软算法核心不支持自动调频
chip_count = 1               # 每个软算法设备相当于1个虚拟芯片

[[devices.chains]]
id = 1
enabled = true
frequency = 1000
voltage = 900
auto_tune = false
chip_count = 1

# =============================================================================
# 矿池配置
# =============================================================================
[pools]
# 矿池策略: Failover, RoundRobin, LoadBalance, Quota
strategy = "Failover"

# 故障转移超时时间 (秒)
failover_timeout = 30

# 重试间隔 (秒)
retry_interval = 10

# 矿池列表 - F2Pool 配置 (适配软算法核心)
# F2Pool支持软算法核心产生的真实份额提交
[[pools.pools]]
url = "stratum+tcp://192.168.18.240:10203"
user = "kayuii.bbt"
password = "21235365876986800"
priority = 1
enabled = true

[[pools.pools]]
url = "stratum+tcp://btc-asia.f2pool.com:1314"
user = "kayuii.bbt"
password = "21235365876986800"
priority = 2
enabled = false

[[pools.pools]]
url = "stratum+tcp://btc-euro.f2pool.com:1314"
user = "kayuii.bbt"
password = "21235365876986800"
priority = 3
enabled = false

[api]
# 启用 API 服务器
enabled = true

# 绑定地址
bind_address = "127.0.0.1"

# API 端口
port = 4028

# 允许的来源 (CORS)
allow_origins = ["*"]

# 认证令牌 (可选，用于 API 安全)
# auth_token = "your-secret-token-here"

[monitoring]
# 启用监控系统
enabled = true

# 指标收集间隔 (秒)
metrics_interval = 30

# Web监控端口 (可选) - 替代Prometheus的轻量级监控
web_port = 8080

# 告警阈值配置
[monitoring.alert_thresholds]
# 温度告警阈值 (°C)
temperature_warning = 80.0
temperature_critical = 90.0

# 算力下降告警阈值 (百分比)
hashrate_drop_percent = 20.0

# 错误率告警阈值 (百分比)
error_rate_percent = 5.0

# 其他阈值
max_temperature = 85.0
max_cpu_usage = 80.0
max_memory_usage = 90.0
max_device_temperature = 85.0
max_error_rate = 5.0
min_hashrate = 1.5  # 调整为1.5 GH/s，适合软算法核心的实际性能

# =============================================================================
# =============================================================================
# Web监控界面配置 (轻量级监控替代Prometheus)
# =============================================================================
[web]
# 启用Web监控界面
enabled = true

# 绑定地址
bind_address = "127.0.0.1"

# Web监控端口
port = 8080

# 静态文件路径 (可选)
static_path = "web/static"

# =============================================================================
# 算力计量器配置 (定期算力输出)
# =============================================================================
[hashmeter]
# 启用算力计量器 - 提供类似传统cgminer的定期算力输出
enabled = true

# 算力输出间隔 (秒) - 每30秒输出一次算力统计
log_interval = 30

# 启用设备级别统计 - 显示每个设备的详细算力信息
per_device_stats = true

# 启用控制台输出 - 在控制台显示算力信息
console_output = true

# 启用美化输出 - 使用emoji和颜色，符合CGMiner-RS的美化日志风格
beautiful_output = true

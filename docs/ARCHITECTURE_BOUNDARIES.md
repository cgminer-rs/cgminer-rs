# CGMiner-RS æ¶æ„è¾¹ç•Œå®šä¹‰

## ğŸ“– æ¦‚è¿°

æœ¬æ–‡æ¡£æ˜ç¡®å®šä¹‰äº† CGMiner-RS ç”Ÿæ€ç³»ç»Ÿä¸­åº”ç”¨å±‚ä¸å¼•æ“å±‚çš„èŒè´£è¾¹ç•Œï¼Œç¡®ä¿æ¸…æ™°çš„æ¶æ„åˆ†ç¦»å’Œé«˜æ•ˆçš„åä½œã€‚

## ğŸ—ï¸ æ•´ä½“æ¶æ„

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (cgminer-rs)                      â”‚
â”‚  ğŸ¯ åº”ç”¨ç¼–æ’ | ğŸŒ ç½‘ç»œæœåŠ¡ | ğŸ“Š ç›‘æ§ç®¡ç† | âš™ï¸ é…ç½®ç®¡ç†       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                        æ ‡å‡†åŒ–æ¥å£ (cgminer-core)
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 å¼•æ“å±‚ (å¤–ç½®æ ¸å¿ƒæ¨¡å—)                       â”‚
â”‚  âš¡ æŒ–çŸ¿ç®—æ³• | ğŸ”§ è®¾å¤‡æ§åˆ¶ | ğŸ“ˆ æ€§èƒ½ä¼˜åŒ– | ğŸŒ¡ï¸ ç¡¬ä»¶ç›‘æ§     â”‚
â”‚                                                              â”‚
â”‚  â€¢ cgminer-cpu-btc-core     â€¢ cgminer-gpu-btc-core         â”‚
â”‚  â€¢ cgminer-asic-*-core      â€¢ å…¶ä»–ä¸“ç”¨æ ¸å¿ƒ...               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                          ç¡¬ä»¶æŠ½è±¡å±‚
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç‰©ç†ç¡¬ä»¶å±‚                               â”‚
â”‚     ğŸ’» CPU | ğŸ® GPU | ğŸ”Œ ASIC | ğŸŒ¡ï¸ ä¼ æ„Ÿå™¨ | âš¡ ç”µæº        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ åº”ç”¨å±‚èŒè´£è¾¹ç•Œ (cgminer-rs)

### âœ… æ ¸å¿ƒèŒè´£

#### 1. **åº”ç”¨ç¨‹åºå…¥å£å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†**
- ä¸»ç¨‹åºå¯åŠ¨ã€åˆå§‹åŒ–ã€å…³é—­æµç¨‹
- ä¿¡å·å¤„ç† (SIGTERM, SIGINT ç­‰)
- ä¼˜é›…å…³é—­å’Œèµ„æºæ¸…ç†
- é”™è¯¯æ¢å¤å’Œé‡å¯æœºåˆ¶

#### 2. **é…ç½®ç®¡ç†**
- é…ç½®æ–‡ä»¶è§£æ (TOML, JSON ç­‰)
- å‘½ä»¤è¡Œå‚æ•°å¤„ç†
- ç¯å¢ƒå˜é‡é›†æˆ
- é…ç½®éªŒè¯å’Œé»˜è®¤å€¼å¤„ç†
- åŠ¨æ€é…ç½®çƒ­é‡è½½

#### 3. **çŸ¿æ± è¿æ¥å’Œç½‘ç»œç®¡ç†**
- Stratum åè®®å®ç°
- çŸ¿æ± è¿æ¥æ± ç®¡ç†
- ç½‘ç»œæ•…éšœè½¬ç§»
- SOCKS5 ä»£ç†æ”¯æŒ
- SSL/TLS è¿æ¥ç®¡ç†

#### 4. **å·¥ä½œåˆ†å‘å’Œç»“æœæ”¶é›†**
- ä»çŸ¿æ± æ¥æ”¶å·¥ä½œ (getwork, stratum)
- å·¥ä½œä»»åŠ¡è·¯ç”±åˆ°åˆé€‚çš„å¼•æ“æ ¸å¿ƒ
- æ”¶é›†å„æ ¸å¿ƒçš„æŒ–çŸ¿ç»“æœ
- ç»“æœéªŒè¯å’Œæäº¤åˆ°çŸ¿æ± 

#### 5. **API æœåŠ¡å’Œ Web ç•Œé¢**
- RESTful API æœåŠ¡å™¨
- WebSocket å®æ—¶æ•°æ®æ¨é€
- Web ç®¡ç†ç•Œé¢
- ç¬¬ä¸‰æ–¹é›†æˆæ¥å£

#### 6. **ç›‘æ§å’Œæ—¥å¿—ç®¡ç†**
- ç³»ç»Ÿçº§ç›‘æ§ (CPUã€å†…å­˜ã€ç½‘ç»œ)
- æ—¥å¿—æ”¶é›†ã€æ ¼å¼åŒ–ã€è½®è½¬
- æ€§èƒ½æŒ‡æ ‡èšåˆ
- å‘Šè­¦ç³»ç»Ÿ
- Prometheus/Grafana é›†æˆ

#### 7. **æ ¸å¿ƒç¼–æ’å’Œè°ƒåº¦**
- æŒ–çŸ¿æ ¸å¿ƒå®ä¾‹ç®¡ç†
- è´Ÿè½½å‡è¡¡ç­–ç•¥
- æ•…éšœæ£€æµ‹å’Œæ ¸å¿ƒåˆ‡æ¢
- èµ„æºåˆ†é…ä¼˜åŒ–

### âŒ **ä¸è´Ÿè´£çš„é¢†åŸŸ**
- å…·ä½“æŒ–çŸ¿ç®—æ³•å®ç°
- ç¡¬ä»¶è®¾å¤‡ç›´æ¥æ§åˆ¶
- åº•å±‚æ€§èƒ½ä¼˜åŒ–
- ç¡¬ä»¶æ¸©åº¦/ç”µå‹ç›‘æ§
- CPU äº²å’Œæ€§ç»‘å®š

---

## âš¡ å¼•æ“å±‚èŒè´£è¾¹ç•Œ (å¤–ç½®æ ¸å¿ƒ)

### âœ… æ ¸å¿ƒèŒè´£

#### 1. **æŒ–çŸ¿ç®—æ³•å®ç°**
- SHA256ã€Scrypt ç­‰ç®—æ³•ä¼˜åŒ–
- SIMD æŒ‡ä»¤é›†åˆ©ç”¨
- ç¡¬ä»¶åŠ é€Ÿæ”¯æŒ
- ç®—æ³•ç‰¹å®šä¼˜åŒ–

#### 2. **è®¾å¤‡æŠ½è±¡å’Œç®¡ç†**
- è®¾å¤‡å‘ç°å’Œè¯†åˆ«
- è®¾å¤‡ç”Ÿå‘½å‘¨æœŸç®¡ç†
- è®¾å¤‡çŠ¶æ€ç›‘æ§
- è®¾å¤‡é…ç½®åº”ç”¨

#### 3. **ç¡¬ä»¶æ§åˆ¶å’Œç›‘æ§**
- é¢‘ç‡ã€ç”µå‹è°ƒèŠ‚
- æ¸©åº¦ã€åŠŸè€—ç›‘æ§
- é£æ‰‡é€Ÿåº¦æ§åˆ¶
- ç¡¬ä»¶é”™è¯¯æ£€æµ‹

#### 4. **æ€§èƒ½ä¼˜åŒ–**
- CPU äº²å’Œæ€§ç»‘å®š
- å†…å­˜ä¼˜åŒ–
- å¹¶å‘ç­–ç•¥ä¼˜åŒ–
- å¹³å°ç‰¹å®šä¼˜åŒ–

#### 5. **å·¥ä½œå¤„ç†**
- æ¥æ”¶åº”ç”¨å±‚åˆ†å‘çš„å·¥ä½œ
- å·¥ä½œåˆ†è§£å’Œå¹¶è¡Œå¤„ç†
- Nonce æœç´¢å’ŒéªŒè¯
- ç»“æœç”Ÿæˆå’Œä¸ŠæŠ¥

### âŒ **ä¸è´Ÿè´£çš„é¢†åŸŸ**
- çŸ¿æ± é€šä¿¡
- ç½‘ç»œè¿æ¥ç®¡ç†
- å…¨å±€é…ç½®ç®¡ç†
- Web ç•Œé¢
- ç³»ç»Ÿçº§ç›‘æ§

---

## ğŸ”Œ æ¥å£å®šä¹‰å’Œè¾¹ç•Œåè®®

### æ ‡å‡†åŒ–æ¥å£ (cgminer-core)

```rust
// æ ¸å¿ƒå·¥å‚æ¥å£
pub trait CoreFactory {
    async fn create_core(&self, config: CoreConfig) -> Result<Box<dyn MiningCore>>;
    fn validate_config(&self, config: &CoreConfig) -> Result<()>;
    fn default_config(&self) -> CoreConfig;
}

// æŒ–çŸ¿æ ¸å¿ƒæ¥å£
pub trait MiningCore {
    async fn initialize(&mut self, config: CoreConfig) -> Result<()>;
    async fn start(&mut self) -> Result<()>;
    async fn stop(&mut self) -> Result<()>;
    async fn submit_work(&mut self, work: Work) -> Result<()>;
    async fn collect_results(&mut self) -> Result<Vec<MiningResult>>;
    async fn get_stats(&self) -> Result<CoreStats>;
}

// è®¾å¤‡æ¥å£
pub trait MiningDevice {
    async fn start(&mut self) -> Result<()>;
    async fn stop(&mut self) -> Result<()>;
    async fn submit_work(&mut self, work: Work) -> Result<()>;
    async fn get_result(&mut self) -> Result<Option<MiningResult>>;
    async fn get_stats(&self) -> Result<DeviceStats>;
}
```

### æ•°æ®æµåè®®

```text
åº”ç”¨å±‚ â†’ å¼•æ“å±‚:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Work      â”‚â”€â”€â”€â–¶â”‚ CoreConfig  â”‚â”€â”€â”€â–¶â”‚   Command   â”‚
â”‚   Config    â”‚    â”‚   Stats     â”‚    â”‚   Control   â”‚
â”‚   Control   â”‚    â”‚   Request   â”‚    â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¼•æ“å±‚ â†’ åº”ç”¨å±‚:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MiningResultâ”‚â—„â”€â”€â”€â”‚ DeviceStats â”‚â—„â”€â”€â”€â”‚   Events    â”‚
â”‚ CoreStats   â”‚    â”‚   Metrics   â”‚    â”‚   Errors    â”‚
â”‚ Health      â”‚    â”‚   Status    â”‚    â”‚   Alerts    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š ä¾èµ–å…³ç³»çŸ©é˜µ

| æ¨¡å—ç±»å‹ | cgminer-rs | cpu-btc-core | gpu-btc-core | asic-*-core | cgminer-core |
|----------|------------|--------------|--------------|-------------|--------------|
| **cgminer-rs** | - | âœ… ä½¿ç”¨ | âœ… ä½¿ç”¨ | âœ… ä½¿ç”¨ | âœ… å®ç° |
| **cpu-btc-core** | âŒ ç¦æ­¢ | - | âŒ ç¦æ­¢ | âŒ ç¦æ­¢ | âœ… å®ç° |
| **gpu-btc-core** | âŒ ç¦æ­¢ | âŒ ç¦æ­¢ | - | âŒ ç¦æ­¢ | âœ… å®ç° |
| **asic-*-core** | âŒ ç¦æ­¢ | âŒ ç¦æ­¢ | âŒ ç¦æ­¢ | - | âœ… å®ç° |
| **cgminer-core** | âŒ ç¦æ­¢ | âŒ ç¦æ­¢ | âŒ ç¦æ­¢ | âŒ ç¦æ­¢ | - |

**è§„åˆ™ï¼š**
- âœ… **å…è®¸**ï¼šä¸Šå±‚å¯ä»¥ä¾èµ–ä¸‹å±‚
- âŒ **ç¦æ­¢**ï¼šä¸‹å±‚ä¸èƒ½ä¾èµ–ä¸Šå±‚ï¼ŒåŒå±‚ä¸èƒ½äº’ç›¸ä¾èµ–

---

## ğŸš§ é‡æ„æŒ‡å¯¼åŸåˆ™

### 1. **å•å‘ä¾èµ–åŸåˆ™**
- åº”ç”¨å±‚å¯ä»¥è°ƒç”¨å¼•æ“å±‚
- å¼•æ“å±‚ä¸èƒ½ç›´æ¥è°ƒç”¨åº”ç”¨å±‚
- é€šè¿‡å›è°ƒã€äº‹ä»¶ã€æ¥å£å®ç°åå‘é€šä¿¡

### 2. **æ¥å£ç¨³å®šæ€§åŸåˆ™**
- `cgminer-core` æ¥å£ä¿æŒå‘åå…¼å®¹
- ç‰ˆæœ¬åŒ– API å˜æ›´
- å¼ƒç”¨è­¦å‘Šå’Œè¿ç§»æŒ‡å—

### 3. **èŒè´£å•ä¸€åŸåˆ™**
- æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªæ˜ç¡®çš„é¢†åŸŸ
- é¿å…åŠŸèƒ½é‡å å’ŒèŒè´£æ¨¡ç³Š
- æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œ

### 4. **é…ç½®ä¼ é€’åŸåˆ™**
```text
å…¨å±€é…ç½® (cgminer-rs)
    â†“ è§£æå’ŒéªŒè¯
æ ¸å¿ƒé…ç½® (CoreConfig)
    â†“ ä¼ é€’åˆ°å¼•æ“
è®¾å¤‡é…ç½® (DeviceConfig)
    â†“ åº”ç”¨åˆ°ç¡¬ä»¶
ç¡¬ä»¶å‚æ•° (é¢‘ç‡/ç”µå‹/æ¸©åº¦)
```

---

## ğŸ› ï¸ å®æ–½æ­¥éª¤

### é˜¶æ®µ 1: æ¸…ç†é‡å¤å¯¼å‡º ğŸ§¹
```bash
# ç§»é™¤ cgminer-rs/src/lib.rs ä¸­çš„é‡å¤å¯¼å‡º
- pub use temperature::{TemperatureManager, TemperatureConfig};
- pub use performance::{PerformanceOptimizer, PerformanceConfig};
- pub use cpu_affinity::CpuAffinityManager;
- pub use device::SoftwareDevice;
```

### é˜¶æ®µ 2: é‡æ„é…ç½®ç®¡ç† âš™ï¸
```text
Before: cgminer-rs é…ç½® + cpu-btc-core é…ç½®
After:  cgminer-rs é…ç½® â†’ CoreConfig â†’ å¼•æ“å±‚
```

### é˜¶æ®µ 3: æ ‡å‡†åŒ–æ¥å£ ğŸ”Œ
```text
ç¡®ä¿æ‰€æœ‰å¤–ç½®æ ¸å¿ƒéƒ½å®ç°æ ‡å‡†çš„ CoreFactory å’Œ MiningCore trait
ç§»é™¤ç›´æ¥çš„ç±»å‹å¯¼å‡ºï¼Œåªé€šè¿‡æ¥å£äº¤äº’
```

### é˜¶æ®µ 4: æµ‹è¯•å’ŒéªŒè¯ âœ…
```text
é›†æˆæµ‹è¯•éªŒè¯è¾¹ç•Œæ¸…æ™°
æ€§èƒ½æµ‹è¯•ç¡®ä¿æ— æ€§èƒ½é€€åŒ–
å…¼å®¹æ€§æµ‹è¯•ç¡®ä¿ç°æœ‰åŠŸèƒ½æ­£å¸¸
```

---

## ğŸ“‹ è¾¹ç•Œæ£€æŸ¥æ¸…å•

### âœ… åº”ç”¨å±‚æ£€æŸ¥
- [ ] ä¸åŒ…å«å…·ä½“æŒ–çŸ¿ç®—æ³•
- [ ] ä¸ç›´æ¥æ§åˆ¶ç¡¬ä»¶è®¾å¤‡
- [ ] ä¸é‡å¤å¯¼å‡ºå¼•æ“å±‚åŠŸèƒ½
- [ ] ä¸“æ³¨äºæœåŠ¡ç¼–æ’å’Œç”¨æˆ·ç•Œé¢

### âœ… å¼•æ“å±‚æ£€æŸ¥
- [ ] ä¸å¤„ç†ç½‘ç»œè¿æ¥
- [ ] ä¸ç®¡ç†å…¨å±€é…ç½®
- [ ] ä¸æä¾› Web ç•Œé¢
- [ ] ä¸“æ³¨äºæŒ–çŸ¿æ€§èƒ½å’Œç¡¬ä»¶æ§åˆ¶

### âœ… æ¥å£æ£€æŸ¥
- [ ] é€šè¿‡ cgminer-core æ ‡å‡†æ¥å£é€šä¿¡
- [ ] æ²¡æœ‰ç›´æ¥çš„ç±»å‹ä¾èµ–
- [ ] ç‰ˆæœ¬å…¼å®¹æ€§ä¿è¯
- [ ] æ¸…æ™°çš„é”™è¯¯å¤„ç†

---

## ğŸ¯ æˆåŠŸæŒ‡æ ‡

### æŠ€æœ¯æŒ‡æ ‡
- **ä»£ç é‡å¤ç‡** < 10%
- **æ¨¡å—è€¦åˆåº¦** < 20%
- **æ¥å£ç¨³å®šæ€§** > 95%
- **æ„å»ºæ—¶é—´** å‡å°‘ 30%

### ç»´æŠ¤æŒ‡æ ‡
- **æ–°æ ¸å¿ƒé›†æˆæ—¶é—´** < 2 å¤©
- **é…ç½®å˜æ›´å½±å“èŒƒå›´** å•æ¨¡å—
- **é”™è¯¯å®šä½æ—¶é—´** < 30 åˆ†é’Ÿ
- **åŠŸèƒ½æµ‹è¯•è¦†ç›–ç‡** > 90%

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [API æ¥å£æ–‡æ¡£](./api-reference.md)
- [æ ¸å¿ƒå¼€å‘æŒ‡å—](./core-development-guide.md)
- [é…ç½®å‚è€ƒ](./configuration-reference.md)
- [æ•…éšœæ’é™¤æŒ‡å—](./troubleshooting.md)

---

**æœ€åæ›´æ–°**: 2024-12-19
**ç‰ˆæœ¬**: 1.0
**çŠ¶æ€**: å¾…å®æ–½
